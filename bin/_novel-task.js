#!/usr/bin/env node
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const fs = require("fs-extra");
const path = require("upath2");
const index_1 = require("../index");
const config_1 = require("../lib/config");
const __1 = require("..");
const FastGlob = require("fast-glob");
const crossSpawn = require("cross-spawn");
const log_1 = require("../lib/log");
(async () => {
    let CWD = process.cwd();
    log_1.default.log(`CWD`, CWD);
    const result = config_1.loadMainConfig(CWD);
    if (!result) {
        throw new Error(`無法找到 config`);
    }
    log_1.default.info(`找到 config 位於 ${result.filepath}`);
    //	console.dir(result, {
    //		depth: 4,
    //	});
    let cache = config_1.loadCacheConfig(CWD);
    let IS_INIT = false;
    log_1.default.dir(cache);
    if (!cache || result.config.debug && result.config.debug.init) {
        cache = {
            config: {
                last: 10,
            },
            filepath: path.resolve(CWD, './.cache', '.cache.json'),
        };
        IS_INIT = true;
        log_1.default.warn(`本次為初始化任務，將分析最近 ${cache.config.last} 次紀錄`);
    }
    else if (result.config.debug && result.config.debug.last) {
        cache.config.last = result.config.debug.last;
        log_1.default.debug('[DEBUG]', `由上次紀錄 ${cache.config.last} 之後 開始檢查`);
    }
    else {
        log_1.default.debug(`由上次紀錄 ${cache.config.last} 之後 開始檢查`);
    }
    if (cache.config.last_push_head) {
        try {
            let cp = crossSpawn.sync('git', [
                'branch',
                '--remotes',
                'origin/master',
                '--contains',
                cache.config.last_push_head,
            ], {
                cwd: result.config.cwd,
            }).stdout.toString().trim();
            if (cp != 'origin/master') {
                log_1.default.warn(`上次推送的分支 ${cache.config.last_push_head} 似乎未被合併`);
                log_1.default.yellow(`本次將重新由上次起始點 ${cache.config.last_from} 開始`);
                cache.config.last = cache.config.last_from;
            }
        }
        catch (e) {
        }
    }
    let data = __1.novelDiffFromLog({
        novelRoot: result.config.cwd,
        baseHash: cache.config.last,
    });
    if (1 && IS_INIT && !result.config.disableInit) {
        log_1.default.warn(`本次為初始化任務，將執行全部任務`);
        //		console.log(result);
        await FastGlob([
            '**/*.md',
            '**/*.txt',
        ], {
            cwd: result.config.cwd,
        })
            .then(ls => {
            return index_1.globToFakeList(ls);
        })
            .then(function (ret) {
            return Object.assign(data, ret);
        });
    }
    if (!result.config.nocache && data.count.novel) {
        cache.config.last = data.range.from;
        //		cache.config.last_from = data.range.from;
        cache.config.done = -1;
        fs.writeJSONSync(cache.filepath, cache.config, {
            spaces: 2,
        });
    }
    if (Object.keys(data.list).length) {
        log_1.default.debug(`在上次的更新 ${data.range.from} 之後 有 ${data.count.novel} 小說 ${data.count.file} 檔案產生變動`);
    }
    else {
        log_1.default.warn(`在上次的更新 ${data.range.from} 之後 沒有新的變化`);
    }
    await __1.runTask(data, result, {
        init: IS_INIT,
    });
    if (!result.config.nocache && data.count.novel) {
        log_1.default.debug(data.range);
        cache.config.last = data.range.to;
        cache.config.last_from = data.range.from;
        cache.config.done = 1;
        log_1.default.dir(cache);
        fs.writeJSONSync(cache.filepath, cache.config, {
            spaces: 2,
        });
    }
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiX25vdmVsLXRhc2suanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJfbm92ZWwtdGFzay50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFFQSwrQkFBK0I7QUFFL0IsK0JBQStCO0FBQy9CLG9DQUEwQztBQUMxQywwQ0FBNEU7QUFDNUUsMEJBQW1GO0FBRW5GLHNDQUFzQztBQUN0QywwQ0FBMEM7QUFDMUMsb0NBQWlDO0FBRWpDLENBQUMsS0FBSyxJQUFJLEVBQUU7SUFFWCxJQUFJLEdBQUcsR0FBRyxPQUFPLENBQUMsR0FBRyxFQUFFLENBQUM7SUFFeEIsYUFBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFFeEIsTUFBTSxNQUFNLEdBQUcsdUJBQWMsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUVuQyxJQUFJLENBQUMsTUFBTSxFQUNYO1FBQ0MsTUFBTSxJQUFJLEtBQUssQ0FBQyxhQUFhLENBQUMsQ0FBQTtLQUM5QjtJQUVELGFBQU8sQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLE1BQU0sQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDO0lBQ2pELHdCQUF3QjtJQUN4QixhQUFhO0lBQ2IsTUFBTTtJQUVMLElBQUksS0FBSyxHQUFHLHdCQUFlLENBQUMsR0FBRyxDQUFDLENBQUM7SUFFakMsSUFBSSxPQUFPLEdBQUcsS0FBSyxDQUFDO0lBRXBCLGFBQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUM7SUFFbkIsSUFBSSxDQUFDLEtBQUssSUFBSSxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssSUFBSSxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQzdEO1FBQ0MsS0FBSyxHQUFHO1lBQ1AsTUFBTSxFQUFFO2dCQUNQLElBQUksRUFBRSxFQUFtQjthQUN6QjtZQUNELFFBQVEsRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxVQUFVLEVBQUUsYUFBYSxDQUFDO1NBQ3RELENBQUM7UUFF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OlsiIyEvdXNyL2Jpbi9lbnYgbm9kZVxuXG5pbXBvcnQgKiBhcyBmcyBmcm9tICdmcy1leHRyYSc7XG5pbXBvcnQgZ2l0bG9nIGZyb20gJ2dpdGxvZzInO1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tICd1cGF0aDInO1xuaW1wb3J0IHsgZ2xvYlRvRmFrZUxpc3QgfSBmcm9tICcuLi9pbmRleCc7XG5pbXBvcnQgbG9hZENvbmZpZywgeyBsb2FkQ2FjaGVDb25maWcsIGxvYWRNYWluQ29uZmlnIH0gZnJvbSAnLi4vbGliL2NvbmZpZyc7XG5pbXBvcnQgeyBwYXRoUmVsYXRpdmUsIG5vdmVsRGlmZkZyb21Mb2csIElDb25maWcsIHJ1blRhc2ssIE1PRFVMRV9OQU1FIH0gZnJvbSAnLi4nO1xuaW1wb3J0ICogYXMgUHJvbWlzZSBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgKiBhcyBGYXN0R2xvYiBmcm9tICdmYXN0LWdsb2InO1xuaW1wb3J0ICogYXMgY3Jvc3NTcGF3biBmcm9tICdjcm9zcy1zcGF3bic7XG5pbXBvcnQgY29uc29sZSBmcm9tICcuLi9saWIvbG9nJztcblxuKGFzeW5jICgpID0+XG57XG5cdGxldCBDV0QgPSBwcm9jZXNzLmN3ZCgpO1xuXG5cdGNvbnNvbGUubG9nKGBDV0RgLCBDV0QpO1xuXG5cdGNvbnN0IHJlc3VsdCA9IGxvYWRNYWluQ29uZmlnKENXRCk7XG5cblx0aWYgKCFyZXN1bHQpXG5cdHtcblx0XHR0aHJvdyBuZXcgRXJyb3IoYOeEoeazleaJvuWIsCBjb25maWdgKVxuXHR9XG5cblx0Y29uc29sZS5pbmZvKGDmib7liLAgY29uZmlnIOS9jeaWvCAke3Jlc3VsdC5maWxlcGF0aH1gKTtcbi8vXHRjb25zb2xlLmRpcihyZXN1bHQsIHtcbi8vXHRcdGRlcHRoOiA0LFxuLy9cdH0pO1xuXG5cdGxldCBjYWNoZSA9IGxvYWRDYWNoZUNvbmZpZyhDV0QpO1xuXG5cdGxldCBJU19JTklUID0gZmFsc2U7XG5cblx0Y29uc29sZS5kaXIoY2FjaGUpO1xuXG5cdGlmICghY2FjaGUgfHwgcmVzdWx0LmNvbmZpZy5kZWJ1ZyAmJiByZXN1bHQuY29uZmlnLmRlYnVnLmluaXQpXG5cdHtcblx0XHRjYWNoZSA9IHtcblx0XHRcdGNvbmZpZzoge1xuXHRcdFx0XHRsYXN0OiAxMCBhcyBhbnkgYXMgc3RyaW5nLFxuXHRcdFx0fSxcblx0XHRcdGZpbGVwYXRoOiBwYXRoLnJlc29sdmUoQ1dELCAnLi8uY2FjaGUnLCAnLmNhY2hlLmpzb24nKSxcblx0XHR9O1xuXG5cdFx0SVNfSU5JVCA9IHRydWU7XG5cblx0XHRjb25zb2xlLndhcm4oYOacrOasoeeCuuWIneWni+WMluS7u+WLme+8jOWwh+WIhuaekOacgOi/kSAke2NhY2hlLmNvbmZpZy5sYXN0fSDmrKHntIDpjIRgKTtcblx0fVxuXHRlbHNlIGlmIChyZXN1bHQuY29uZmlnLmRlYnVnICYmIHJlc3VsdC5jb25maWcuZGVidWcubGFzdClcblx0e1xuXHRcdGNhY2hlLmNvbmZpZy5sYXN0ID0gcmVzdWx0LmNvbmZpZy5kZWJ1Zy5sYXN0O1xuXG5cdFx0Y29uc29sZS5kZWJ1ZygnW0RFQlVHXScsIGDnlLHkuIrmrKHntIDpjIQgJHtjYWNoZS5jb25maWcubGFzdH0g5LmL5b6MIOmWi+Wni+aqouafpWApO1xuXHR9XG5cdGVsc2Vcblx0e1xuXHRcdGNvbnNvbGUuZGVidWcoYOeUseS4iuasoee0gOmMhCAke2NhY2hlLmNvbmZpZy5sYXN0fSDkuYvlvowg6ZaL5aeL5qqi5p+lYCk7XG5cdH1cblxuXHRpZiAoY2FjaGUuY29uZmlnLmxhc3RfcHVzaF9oZWFkKVxuXHR7XG5cdFx0dHJ5XG5cdFx0e1xuXHRcdFx0bGV0IGNwID0gY3Jvc3NTcGF3bi5zeW5jKCdnaXQnLCBbXG5cdFx0XHRcdCdicmFuY2gnLFxuXHRcdFx0XHQnLS1yZW1vdGVzJyxcblx0XHRcdFx0J29yaWdpbi9tYXN0ZXInLFxuXHRcdFx0XHQnLS1jb250YWlucycsXG5cdFx0XHRcdGNhY2hlLmNvbmZpZy5sYXN0X3B1c2hfaGVhZCxcblx0XHRcdF0sIHtcblx0XHRcdFx0Y3dkOiByZXN1bHQuY29uZmlnLmN3ZCxcblx0XHRcdH0pLnN0ZG91dC50b1N0cmluZygpLnRyaW0oKTtcblxuXHRcdFx0aWYgKGNwICE9ICdvcmlnaW4vbWFzdGVyJylcblx0XHRcdHtcblx0XHRcdFx0Y29uc29sZS53YXJuKGDkuIrmrKHmjqjpgIHnmoTliIbmlK8gJHtjYWNoZS5jb25maWcubGFzdF9wdXNoX2hlYWR9IOS8vOS5juacquiiq+WQiOS9tWApO1xuXHRcdFx0XHRjb25zb2xlLnllbGxvdyhg5pys5qyh5bCH6YeN5paw55Sx5LiK5qyh6LW35aeL6bueICR7Y2FjaGUuY29uZmlnLmxhc3RfZnJvbX0g6ZaL5aeLYCk7XG5cblx0XHRcdFx0Y2FjaGUuY29uZmlnLmxhc3QgPSBjYWNoZS5jb25maWcubGFzdF9mcm9tO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRjYXRjaCAoZSlcblx0XHR7XG5cblx0XHR9XG5cdH1cblxuXHRsZXQgZGF0YSA9IG5vdmVsRGlmZkZyb21Mb2coe1xuXHRcdG5vdmVsUm9vdDogcmVzdWx0LmNvbmZpZy5jd2QsXG5cdFx0YmFzZUhhc2g6IGNhY2hlLmNvbmZpZy5sYXN0LFxuXHR9KTtcblxuXHRpZiAoMSAmJiBJU19JTklUICYmICFyZXN1bHQuY29uZmlnLmRpc2FibGVJbml0KVxuXHR7XG5cdFx0Y29uc29sZS53YXJuKGDmnKzmrKHngrrliJ3lp4vljJbku7vli5nvvIzlsIfln7fooYzlhajpg6jku7vli5lgKTtcblxuLy9cdFx0Y29uc29sZS5sb2cocmVzdWx0KTtcblxuXHRcdGF3YWl0IEZhc3RHbG9iPHN0cmluZz4oW1xuXHRcdFx0JyoqLyoubWQnLFxuXHRcdFx0JyoqLyoudHh0Jyxcblx0XHRdLCB7XG5cdFx0XHRjd2Q6IHJlc3VsdC5jb25maWcuY3dkLFxuXHRcdH0pXG5cdFx0XHQudGhlbihscyA9PlxuXHRcdFx0e1xuXHRcdFx0XHRyZXR1cm4gZ2xvYlRvRmFrZUxpc3QobHMpO1xuXHRcdFx0fSlcblx0XHRcdC50aGVuKGZ1bmN0aW9uIChyZXQpXG5cdFx0XHR7XG5cdFx0XHRcdHJldHVybiBPYmplY3QuYXNzaWduKGRhdGEsIHJldCk7XG5cdFx0XHR9KVxuXHRcdDtcblx0fVxuXG5cdGlmICghcmVzdWx0LmNvbmZpZy5ub2NhY2hlICYmIGRhdGEuY291bnQubm92ZWwpXG5cdHtcblx0XHRjYWNoZS5jb25maWcubGFzdCA9IGRhdGEucmFuZ2UuZnJvbTtcbi8vXHRcdGNhY2hlLmNvbmZpZy5sYXN0X2Zyb20gPSBkYXRhLnJhbmdlLmZyb207XG5cblx0XHRjYWNoZS5jb25maWcuZG9uZSA9IC0xO1xuXG5cdFx0ZnMud3JpdGVKU09OU3luYyhjYWNoZS5maWxlcGF0aCwgY2FjaGUuY29uZmlnLCB7XG5cdFx0XHRzcGFjZXM6IDIsXG5cdFx0fSk7XG5cdH1cblxuXHRpZiAoT2JqZWN0LmtleXMoZGF0YS5saXN0KS5sZW5ndGgpXG5cdHtcblx0XHRjb25zb2xlLmRlYnVnKGDlnKjkuIrmrKHnmoTmm7TmlrAgJHtkYXRhLnJhbmdlLmZyb219IOS5i+W+jCDmnIkgJHtkYXRhLmNvdW50Lm5vdmVsfSDlsI/oqqogJHtkYXRhLmNvdW50LmZpbGV9IOaqlOahiOeUoueUn+iuiuWLlWApO1xuXHR9XG5cdGVsc2Vcblx0e1xuXHRcdGNvbnNvbGUud2Fybihg5Zyo5LiK5qyh55qE5pu05pawICR7ZGF0YS5yYW5nZS5mcm9tfSDkuYvlvowg5rKS5pyJ5paw55qE6K6K5YyWYCk7XG5cdH1cblxuXHRhd2FpdCBydW5UYXNrKGRhdGEsIHJlc3VsdCwge1xuXHRcdGluaXQ6IElTX0lOSVQsXG5cdH0pO1xuXG5cdGlmICghcmVzdWx0LmNvbmZpZy5ub2NhY2hlICYmIGRhdGEuY291bnQubm92ZWwpXG5cdHtcblx0XHRjb25zb2xlLmRlYnVnKGRhdGEucmFuZ2UpO1xuXG5cdFx0Y2FjaGUuY29uZmlnLmxhc3QgPSBkYXRhLnJhbmdlLnRvO1xuXHRcdGNhY2hlLmNvbmZpZy5sYXN0X2Zyb20gPSBkYXRhLnJhbmdlLmZyb207XG5cblx0XHRjYWNoZS5jb25maWcuZG9uZSA9IDE7XG5cblx0XHRjb25zb2xlLmRpcihjYWNoZSk7XG5cblx0XHRmcy53cml0ZUpTT05TeW5jKGNhY2hlLmZpbGVwYXRoLCBjYWNoZS5jb25maWcsIHtcblx0XHRcdHNwYWNlczogMixcblx0XHR9KTtcblx0fVxuXG59KSgpO1xuXG4iXX0=